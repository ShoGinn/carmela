window.VIP=window.VIP||{},window.VIP.UI=window.VIP.UI||{},window.VIP.UI.Main=function($,undefined){var self={};self.stageToolTip=void 0,self.stageToolTipSetup=function(){self.stageToolTip=new VIP.UI.WidgetToolTip({jqsElement:"#divStageToolTip",jqsTitleElement:"#divStageToolTipTitle",jqsArrowElement:"#divStageToolTipArrow",jqsEdgeContainer:"#divStage",fade:!0})};return self}(jQuery);var uiPreventDoubleTapZoom_lastTapTime,uiStatusMsgClearTimeoutHandle,uiViewMsgClearTimeoutHandle,uiViewMsgCollapseTimeoutHandle,uiPlanMsgClearTimeoutHandle,PNGSuccessFunc,PNGCurrentPageNumber,PNGArray,EFFECT_SPEED_FADE_OUT="fast",EFFECT_SPEED_FADE_IN="slow",UI_COLOR_PRINTING_DEFAULT="#111",UI_QS_LAYOUT_DEFAULT={hd:2,ft:0,tl:2,op:2,slr:0},UI_QS_LAYOUT_SMALLSCREEN_DEFAULT={hd:0,ft:1,tl:2,op:1,slr:0},uiIsKeyboardDialogShowing=!1,bRan_uiSetupLayout=!1;function collapsibleSetIfp_Collapsible_Close($collapsible){return $collapsible.find("> .ui-collapsible-content").hide((function(){})),killEvent(void 0,!0)}function collapsibleSetIfp_Collapsible_CloseSiblings($collapsible){return $collapsible.siblings().each((function(){$(this).trigger("collapse")})),killEvent(void 0,!0)}function collapsibleSetIfp_Collapsible_Open($collapsible){var nestedFirstHeadingTxt,$nested=$collapsible.find("> .ui-collapsible-content > .ui-collapsible"),$nestedFirst=$nested.first(),$nestedFirstHeading=$nestedFirst.find("> .ui-collapsible-heading");return 1===$nested.length?($nestedFirstHeading.hide(),(nestedFirstHeadingTxt=$nestedFirstHeading.find(".ui-btn-text").contents().get(0).nodeValue)&&($collapsible.find(".ui-btn-text").contents().get(0).nodeValue=nestedFirstHeadingTxt)):$nestedFirstHeading.addClass("ui-collapsible-heading-active"),$nestedFirst.trigger("expand"),$collapsible.find("> .ui-collapsible-content").show((function(){collapsibleSetIfp_Collapsible_CloseSiblings($collapsible)})),killEvent(void 0,!0)}function collapsibleSetIfp_Create($collapsibleSetContainer,$collapsibleToOpen){var $collapsibles=$collapsibleSetContainer.find('[data-role="collapsible"]');($collapsibles.find(".ui-collapsible-content").addClass("ui-content"),$collapsibles.bind("collapse",(function(event,ui){return $collapsible=$(this),collapsibleSetIfp_Collapsible_Close($collapsible),killEvent(event,!0)})),$collapsibles.bind("expand",(function(event,ui){return $collapsible=$(this),collapsibleSetIfp_Collapsible_Open($collapsible),killEvent(event,!0)})),$collapsibleToOpen?$collapsibleToOpen.trigger("expand"):$collapsibles.filter(":visible").first().trigger("expand"),$collapsibleSetContainer.addClass("collapsible-set-ifp-created"),isTouchDevice())&&($("#layoutAccordion .ui-collapsible-content .ui-collapsible-content").css("flex-flow","unset"),$("#layoutOptions .ui-collapsible-content .ui-collapsible-content fieldset").mCustomScrollbar({theme:"vip",axis:"y",scrollButtons:{enable:!0},autoDraggerLength:!1,scrollInertia:200,documentTouchScroll:!1}),$("#layoutOptionsImgs .ui-collapsible-content .ui-collapsible-content fieldset").mCustomScrollbar({theme:"vip",axis:"y",scrollButtons:{enable:!0},autoDraggerLength:!1,scrollInertia:200,documentTouchScroll:!1,alwaysShowScrollbar:1}),$("#layoutComponents, #layoutFurniture").find(".ui-collapsible-content .ui-collapsible-content ul").mCustomScrollbar({theme:"vip",axis:"y",scrollButtons:{enable:!0},autoDraggerLength:!1,scrollInertia:200,documentTouchScroll:!1,contentTouchScroll:!1}));return killEvent()}function uiDropdownSelect(e){var $btn=$(this);return $btn.hasClass("ui-dropdown-ctl-down")?uiDropdownClose($btn):uiDropdownOpen($btn),killEvent(e,!0)}function uiDropdownClose($btn){var menuid=$btn.attr("data-ctl-for");menuid&&$("#"+menuid).slideUp(EFFECT_SPEED_FADE_OUT),$btn.removeClass("ui-btn-active"),$btn.removeClass("ui-dropdown-ctl-down")}function uiDropdownOpen($btn){var menuid=$btn.attr("data-ctl-for");menuid&&$("#"+menuid).slideDown(EFFECT_SPEED_FADE_IN),$btn.addClass("ui-btn-active"),$btn.addClass("ui-dropdown-ctl-down")}function uiDropdownCloseOthers(){}function uiTabsSelect(e){uiDropdownCloseOthers(),uiTabsCloseOthers(),tabid=$(this).attr("data-ctl-for"),tabid&&setTimeout("$('#' + tabid).fadeIn(EFFECT_SPEED_FADE_IN);",250)}function uiTabsCloseOthers(){$(".ui-tabs-tab").fadeOut(EFFECT_SPEED_FADE_OUT)}function uiDrawerTap(e){}function uiDrawerToggle($handle){}function uiDrawerCloseAllOpen(){}function uiDrawerAToggle(bSkipAnimation){var $drawer=$("#pnlMainA"),$handle=$("#handleMainA"),$menu=$("#divMenu"),$pricing=$("#divPriceGrouping"),duration=EFFECT_SPEED_FADE_IN;!0===bSkipAnimation&&($drawer.hide(),$menu.hide(),duration=1),$drawer.hasClass("ui-drawer-open")?($pricing.hide(),$menu.slideUp(duration,(function(){$menu.hide()})),$drawer.animate({width:0},duration,(function(){$handle.removeClass("ui-drawer-open"),$drawer.removeClass("ui-drawer-open"),$drawer.hide()}))):($drawer.addClass("ui-drawer-open").show().animate({width:46},duration,(function(){$handle.addClass("ui-drawer-open")})),$menu.slideDown(duration,(function(){$menu.show()})),$pricing.show())}function uiDrawerCToggle(bSkipAnimation){dbg("uiDrawerCToggle(bSkipAnimation) "+bSkipAnimation);var $drawer=$("#pnlMainC, #handleMainC"),duration=EFFECT_SPEED_FADE_IN,cssPropsToClose={right:"-=234",width:"-=234"},cssPropsToOpen={right:"+=234",width:"+=234"};$("#pnlMain").hasClass("swap-left-right")&&(cssPropsToClose={left:"-=234",width:"-=234"},cssPropsToOpen={left:"+=234",width:"+=234"}),$drawer.hasClass("ui-drawer-sliding")||(!0===bSkipAnimation&&($drawer.hide(),duration=1),$drawer.hasClass("ui-drawer-open")?$drawer.animate(cssPropsToClose,{duration:duration,start:function(){$(this).addClass("ui-drawer-sliding")},step:function(now,tween){"handleMainC"==$(tween.elem).attr("id")&&"width"==tween.prop?tween.end=now:"pnlMainC"!=$(tween.elem).attr("id")||"right"!=tween.prop&&"left"!=tween.prop||(tween.end=now)},complete:function(){$(this).removeClass("ui-drawer-open").removeClass("ui-drawer-sliding"),$drawer.show()}}):(isSmallScreen()&&uiDropdownClose($("#btnLegend")),$drawer.animate(cssPropsToOpen,{duration:duration,start:function(){$(this).addClass("ui-drawer-sliding")},step:function(now,tween){"handleMainC"==$(tween.elem).attr("id")&&"width"==tween.prop?tween.end=now:"pnlMainC"!=$(tween.elem).attr("id")||"right"!=tween.prop&&"left"!=tween.prop||(tween.end=now)},complete:function(){$(this).addClass("ui-drawer-open").removeClass("ui-drawer-sliding"),$drawer.show()}})))}function uiDrawerFooterToggle(bSkipAnimation){var elemID,$drawer=$("#pnlFooter, #handleFooter");$drawer.hasClass("ui-drawer-sliding")||(!0===bSkipAnimation&&($drawer.hide(),duration=1),$drawer.hasClass("ui-drawer-open")?$drawer.animate({bottom:"-=84",height:"-=85"},{duration:EFFECT_SPEED_FADE_OUT,start:function(){$(this).addClass("ui-drawer-sliding")},step:function(now,tween){("handleFooter"==(elemID=$(tween.elem).attr("id"))&&"height"==tween.prop||"pnlFooter"==elemID&&"bottom"==tween.prop)&&(tween.end=now)},complete:function(){$(this).removeClass("ui-drawer-open").removeClass("ui-drawer-sliding"),$drawer.show()}}):$drawer.animate({bottom:"+=84",height:"+=85"},{duration:EFFECT_SPEED_FADE_IN,start:function(){$(this).addClass("ui-drawer-sliding")},step:function(now,tween){("handleFooter"==(elemID=$(tween.elem).attr("id"))&&"height"==tween.prop||"pnlFooter"==elemID&&"bottom"==tween.prop)&&(tween.end=now)},complete:function(){$(this).addClass("ui-drawer-open").removeClass("ui-drawer-sliding"),$drawer.show()}}))}function uiCheckBrowser(){"iOS"!=uiUserAgent.os.name&&"Chrome"!=uiUserAgent.browser.name&&"Firefox"!=uiUserAgent.browser.name&&uiStatusMsg('For a better experience, please use a different browser, such as <a href="https://www.google.com/chrome/" target="_blank">Google Chrome</a> or <a href="https://www.mozilla.org/en-US/firefox/new/" target="_blank">Firefox</a>.',6e3,!0)}function uiPreventNativeZoomAndScroll(e){e=e.originalEvent||e;$(e.target);return killEvent(e,!0)}function uiSetup(){dbg("uiSetup()"),uiStatusMsg("Loading...",!0),1==$.deparam.querystring().dbg&&dbgSetOutputToWindow(),Modernizr.passiveeventlisteners?document.addEventListener("touchmove",(function(e){return uiPreventNativeZoomAndScroll(e)}),{passive:!1}):$(document).on("touchmove",(function(e){return uiPreventNativeZoomAndScroll(e)})),$(document).on("tap",(function(e){var t2=e.timeStamp,dt=t2-(uiPreventDoubleTapZoom_lastTapTime||t2);uiPreventDoubleTapZoom_lastTapTime=t2,dt&&dt<300&&e.preventDefault()})),OPTION_COLOR_BASE=htmlRGBToHex(cssGetPropertyValue(".option_color_base","color")),OPTION_COLOR=htmlRGBToHex(cssGetPropertyValue(".option_color","color")),OPTION_COLOR_HOVER=htmlRGBToHex(cssGetPropertyValue(".option_color_hover","color")),OPTION_COLOR_NOTFEATURED=htmlRGBToHex(cssGetPropertyValue(".option_color_notfeatured","color")),POI_COLOR_BASE=htmlRGBToHex(cssGetPropertyValue(".poi_color_base","color")),POI_COLOR=htmlRGBToHex(cssGetPropertyValue(".poi_color","color")),POI_COLOR_HOVER=htmlRGBToHex(cssGetPropertyValue(".poi_color_hover","color")),COMP_HALO_COLOR_BASE=htmlRGBToHex(cssGetPropertyValue(".comp_halo_color_base","color")),COMP_HALO_COLOR=htmlRGBToHex(cssGetPropertyValue(".comp_halo_color","color")),COMP_HALO_COLOR_HOVER=htmlRGBToHex(cssGetPropertyValue(".comp_halo_color_hover","color")),COMP_COLOR_ACTIVE=htmlRGBToHex(cssGetPropertyValue(".comp_color","color")),COMP_COLOR_PLACED=htmlRGBToHex(cssGetPropertyValue(".comp_color_placed","color")),COMP_FURNITURE_COLOR_ACTIVE=htmlRGBToHex(cssGetPropertyValue(".furniture_color","color")),COMP_FURNITURE_COLOR_PLACED=htmlRGBToHex(cssGetPropertyValue(".furniture_color_placed","color")),dataNoticeMsgCssVars.SkinColorBackground=htmlRGBToHex(cssGetPropertyValue(".email_SkinColorBackground","color")),dataNoticeMsgCssVars.SkinColorText=htmlRGBToHex(cssGetPropertyValue(".email_SkinColorText","color")),dataNoticeMsgCssVars.SkinColorFill=htmlRGBToHex(cssGetPropertyValue(".email_SkinColorFill","color")),dataNoticeMsgCssVars.SkinColorAccent=htmlRGBToHex(cssGetPropertyValue(".email_SkinColorAccent","color")),uiSetupLayout(),uiSetupEvents(),VIP.UI.Main.stageToolTipSetup(),optionsSetup(),$("#divMenuLegend").trigger("create")}function uiSetupAfterData(){var attr;$("#divHeaderClientName").text(""),$("#divProjectName").text($dataInfo.attr("projectname")),$("#divPlanName").text($dataInfo.attr("displayname")),void 0!==(attr=$dataInfo.attr("clientfaviconurl"))&&!1!==attr&&attr.length>0&&$("#faviconURL").attr("href",attr),void 0!==(attr=$dataInfo.attr("clientmetadescription"))&&!1!==attr&&attr.length>0&&($("#metadescription").attr("content",attr),$("#ogmetadescription").attr("content",attr));var headerInfoURL=$dataInfo.attr("infourl");headerInfoURL&&$("#lnkHeaderLogo").prop("href",headerInfoURL),$("#imgHeaderLogo").imgRetina({new_base_src:$dataInfo.attr("logofile"),fade_in_speed:EFFECT_SPEED_FADE_IN});var headerCenterURL=$dataInfo.attr("headercenterurl");headerCenterURL&&$("#lnkHeaderCenter").prop("href",headerCenterURL),$("#imgHeaderCenter").imgRetina({new_base_src:$dataInfo.attr("headercenterfile"),fade_in_speed:EFFECT_SPEED_FADE_IN}),$("#imgPreview").imgRetina({new_base_src:$dataInfo.attr("previewfile"),fade_in_speed:EFFECT_SPEED_FADE_IN}),$("#divPreviewLabel").children("span").text($dataOptions.find('group[typecode="ext"]').children("option[selected=1]").attr("displayname")),"1"==$dataInfo.attr("clientsaveplanphoneenabled")?($("#divDialogSavePhoneFields").show(),$dataInfo.attr("smstemplate")?$("#txtSendSms").parent(".ui-checkbox").show():$("#txtSendSms").parent(".ui-checkbox").hide()):$("#divDialogSavePhoneFields").hide(),void 0!==$dataInfo.attr("savedplanfirstname")&&$("#txtFirstName").val($dataInfo.attr("savedplanfirstname")),void 0!==$dataInfo.attr("savedplanlastname")&&$("#txtLastName").val($dataInfo.attr("savedplanlastname")),void 0!==$dataInfo.attr("savedplanemail")&&$("#txtEmail").val($dataInfo.attr("savedplanemail")),void 0!==$dataInfo.attr("savedplanphone")&&$("#txtPhone").val($dataInfo.attr("savedplanphone"));var savedPlanName=$dataInfo.attr("savedplanname");savedPlanName&&""!==savedPlanName||(savedPlanName="My Custom "+$dataInfo.attr("displayname")),$("#txtSavedPlanName").val(savedPlanName);var savedPlanPreviewFile=$dataOptions.find('group[typecode="ext"]').children("option[selected=1]").attr("data1");dataSavedPlanID&&savedPlanPreviewFile&&$("#imgPreview").imgRetina({new_base_src:savedPlanPreviewFile,fade_in_speed:EFFECT_SPEED_FADE_IN}),uiComponentsSetup("component",$("#layoutComponents > div")),uiComponentsSetup("furniture",$("#layoutFurniture > div")),uiViewsMenuSetup(),optionsSetupAfterData(),setTimeout("uiSetupLayout(true);",500)}function uiSetupAfterTS(){dataIsLoaded=!0,uiComponentsSavedSetup();var isFlippedH="true"===$dataInfo.attr("flippedh");viewImgsFlip(isFlippedH),$($("#divMenuViews label")[0]).trigger("click"),uiStatusMsgReady(),uiPlanMsgReady(),setTimeout(uiCheckBrowser,1e3),setTimeout(uiSocialMediaSetup,500),setTimeout(uiSetupPrintIFrame,500)}function uiSetupPrintIFrame(){$("#layoutPrintFrame").attr("src","/vip.print.php")}function uiBlockAll(enable,visible){var $blocker=$("#divPageBlocker");return visible=!1===visible?"ui-blocker-invisible":"ui-blocker-darken",enable?$blocker.attr("class","ui-blocker "+visible+" ui-blocker-block-all"):$blocker.attr("class","ui-blocker"),$blocker}function uiBlockMainUI(enable,visible){var $blocker=$("#divHeaderBlocker, #divMainAMenuBlocker, #divMainABlocker, #divMainAHandleBlocker, #divMainCBlocker, #divMainCHandleBlocker, #divFooterBlocker, #divFooterHandleBlocker");return visible=!1===visible?"ui-blocker-invisible":"ui-blocker-darken",enable?$blocker.attr("class","ui-blocker "+visible+" ui-blocker-block-main"):$blocker.attr("class","ui-blocker"),$blocker}function uiBlockStage(enable,visible){var $blocker=$("#divStageBlocker");return visible=!1===visible?"ui-blocker-invisible":"ui-blocker-darken",enable?$blocker.attr("class","ui-blocker "+visible+" ui-blocker-block-main"):$blocker.attr("class","ui-blocker"),$blocker}function uiStatusMsgStartup(){$("#btnStatusClose").on("tap",uiStatusMsgClear),uiStatusMsg("Loading...",!0)}function uiStatusMsgReady(){uiStatusMsg("Loading complete!")}function uiStatusMsgClear(){uiStatusMsgClearTimeoutHandle=void 0,$("#divStatus").slideUp()}function uiStatusMsg(htmlMsg,doPersistOrTimeoutMS,isDismissible){clearTimeout(uiStatusMsgClearTimeoutHandle),$("#divStatusContent").html(htmlMsg),isDismissible?$("#btnStatusClose").show():$("#btnStatusClose").hide(),$("#divStatus").slideDown(),parseInt(doPersistOrTimeoutMS,10)>0?uiStatusMsgClearTimeoutHandle=setTimeout(uiStatusMsgClear,parseInt(doPersistOrTimeoutMS,10)):!0!==doPersistOrTimeoutMS&&(uiStatusMsgClearTimeoutHandle=setTimeout(uiStatusMsgClear,2e3))}function uiStatusMsgErr(htmlMsg,doPersistOrTimeoutMS,isDismissible){void 0!==uiStatusMsgClearTimeoutHandle&&clearTimeout(uiStatusMsgClearTimeoutHandle),$("#divStatusContent").html(htmlMsg),isDismissible?$("#btnStatusClose").show():$("#btnStatusClose").hide(),$("#divStatus").slideDown(),parseInt(doPersistOrTimeoutMS,10)>0?uiStatusMsgClearTimeoutHandle=setTimeout(uiStatusMsgClear,parseInt(doPersistOrTimeoutMS,10)):!0!==doPersistOrTimeoutMS&&(uiStatusMsgClearTimeoutHandle=setTimeout(uiStatusMsgClear,3e3))}function uiViewMsg(viewID,htmlSubject,htmlMsg,doPersistOrTimeoutMS,isDismissible,doPersistExpandedOrTimeoutMS,isCollapsible){dbg("uiViewMsg(viewID, htmlSubject, htmlMsg, doPersistOrTimeoutMS, isDismissible, doPersistExpandedOrTimeoutMS, isCollapsible) "+viewID+", "+htmlSubject+", "+htmlMsg+", "+doPersistOrTimeoutMS+", "+isDismissible+", "+doPersistExpandedOrTimeoutMS+", "+isCollapsible);var $divContainer=$("#divViewMsg"),$divMsg=$("#divViewMsgContent"),$divMsgExpanded=$("#divViewMsgContentExpanded"),$btnClose=$("#btnViewMsgClose");void 0!==uiViewMsgClearTimeoutHandle&&clearTimeout(uiViewMsgClearTimeoutHandle),uiViewMsgClearTimeoutHandle=void 0,$divMsg.html(htmlSubject),$divMsgExpanded.html(htmlMsg),$divMsg.attr("data-for",viewID),$btnClose.attr("data-for",viewID),isDismissible?($btnClose.show(),$btnClose.on("tap",uiViewMsgClear)):$btnClose.hide(),isCollapsible?$divMsg.addClass("msg-collapsible"):($divMsg.removeClass("msg-collapsible"),$divMsg.off("tap")),!0===doPersistExpandedOrTimeoutMS?uiViewMsgExpand(viewID,void 0,!0):parseInt(doPersistExpandedOrTimeoutMS,10)>0?uiViewMsgExpand(viewID,parseInt(doPersistExpandedOrTimeoutMS,10),!1):uiViewMsgCollapse(viewID,!0),$divContainer.show(),parseInt(doPersistOrTimeoutMS,10)>0?uiViewMsgClearTimeoutHandle=setTimeout("uiViewMsgClear('"+viewID+"', false);",parseInt(doPersistOrTimeoutMS,10)):!0!==doPersistOrTimeoutMS&&(uiViewMsgClearTimeoutHandle=setTimeout("uiViewMsgClear('"+viewID+"', false);",3e3))}function uiViewMsgExpand(viewID,iExpandedTimeoutMS,bDoInstant){var isCollapsible=!1;if(void 0!==viewID){"string"!=typeof viewID&&(viewID=$(this).attr("data-for"));var $viewNode=$dataViews.find("view[id="+viewID+"]");$viewNode.attr("msgisstartexpanded","true"),$viewNode.attr("msgautocollapsems",""),isCollapsible=1==$viewNode.attr("msgisusercollapsible")}dbg("isCollapsible==="),dbg(isCollapsible);var $divMsg=$("#divViewMsgContent"),$divMsgExpanded=$("#divViewMsgContentExpanded");return void 0!==uiViewMsgCollapseTimeoutHandle&&clearTimeout(uiViewMsgCollapseTimeoutHandle),uiViewMsgCollapseTimeoutHandle=void 0,$divMsgExpanded.scrollTop($divMsgExpanded.position().top-30),void 0!==iExpandedTimeoutMS&&parseInt(iExpandedTimeoutMS,10)>0?uiViewMsgCollapseTimeoutHandle=setTimeout("uiViewMsgCollapse('"+viewID+"', false);",parseInt(iExpandedTimeoutMS,10)):($divMsg.off("tap"),!0===isCollapsible&&$divMsg.one("tap",uiViewMsgCollapse)),$divMsg.addClass("msg-expanded"),!0===bDoInstant?$divMsgExpanded.show():$divMsgExpanded.slideDown("fast"),!1}function uiViewMsgCollapse(viewID,bDoInstant){var isCollapsible=!1;if(void 0!==viewID){"string"!=typeof viewID&&(viewID=$(this).attr("data-for"));var $viewNode=$dataViews.find("view[id="+viewID+"]");$viewNode.attr("msgisstartexpanded","false"),$viewNode.attr("msgautocollapsems",""),isCollapsible=1==$viewNode.attr("msgisusercollapsible")}dbg("isCollapsible==="),dbg(isCollapsible);var $divMsg=$("#divViewMsgContent"),$divMsgExpanded=$("#divViewMsgContentExpanded");return void 0!==uiViewMsgCollapseTimeoutHandle&&clearTimeout(uiViewMsgCollapseTimeoutHandle),uiViewMsgCollapseTimeoutHandle=void 0,$divMsg.off("tap"),!0===isCollapsible&&$divMsg.one("tap",uiViewMsgExpand),!0===bDoInstant?$divMsgExpanded.hide():$divMsgExpanded.slideUp("fast"),$divMsg.removeClass("msg-expanded"),!1}function uiViewMsgClear(viewID,bDoInstant){void 0!==viewID&&("string"!=typeof viewID&&(viewID=$(this).attr("data-for")),$dataViews.find("view[id="+viewID+"]").attr("msgautodismissms","true"));return void 0!==uiViewMsgCollapseTimeoutHandle&&clearTimeout(uiViewMsgCollapseTimeoutHandle),void 0!==uiViewMsgClearTimeoutHandle&&clearTimeout(uiViewMsgClearTimeoutHandle),uiViewMsgClearTimeoutHandle=void 0,uiViewMsgCollapseTimeoutHandle=void 0,!0===bDoInstant?$("#divViewMsg").hide():$("#divViewMsg").slideUp("fast"),!1}function uiPlanMsgReady(){-1!=$dataInfo.attr("status").indexOf("Pending")&&($("#btnPlanMsgClose").on("tap",uiPlanMsgClear),uiPlanMsg($dataInfo.attr("status"),!0))}function uiPlanMsgClear(){uiPlanMsgClearTimeoutHandle=void 0,$("#divPlanMsg").slideUp()}function uiPlanMsg(htmlMsg,doPersistOrTimeoutMS,isDismissible){clearTimeout(uiPlanMsgClearTimeoutHandle),$("#divPlanMsgContent").html(htmlMsg),isDismissible?$("#btnPlanMsgClose").show():$("#btnPlanMsgClose").hide(),$("#divPlanMsg").slideDown(),parseInt(doPersistOrTimeoutMS,10)>0?uiPlanMsgClearTimeoutHandle=setTimeout(uiPlanMsgClear,parseInt(doPersistOrTimeoutMS,10)):!0!==doPersistOrTimeoutMS&&(uiPlanMsgClearTimeoutHandle=setTimeout(uiPlanMsgClear,5e3))}function uiSetupLayout(bForceRedo){if(!bRan_uiSetupLayout||bForceRedo){var layoutConfig,dbOverride,qsOverride;isSmallScreen()?(layoutConfig=UI_QS_LAYOUT_SMALLSCREEN_DEFAULT,dbOverride=dataUILayoutStringSS||""):(layoutConfig=UI_QS_LAYOUT_DEFAULT,dbOverride=dataUILayoutString||""),dbOverride=$.deparam(dbOverride),$.extend(layoutConfig,dbOverride),qsOverride=$.deparam.querystring(),$.extend(layoutConfig,qsOverride),1==layoutConfig.slr&&($("#pnlHeader").addClass("swap-left-right"),$("#pnlMain").addClass("swap-left-right"),$("#pnlFooter").addClass("swap-left-right")),isSmallScreen()&&(layoutConfig.hd=0,layoutConfig.ft=1);var $pnlHeader=$("#pnlHeader");0==layoutConfig.hd?$pnlHeader.hide():1!=layoutConfig.hd&&2!=layoutConfig.hd||$pnlHeader.show();var $pnlFooter=$("#pnlFooter"),$handleFooter=$("#handleFooter");$pnlFooter.empty(),setTimeout("$('#divHeader').clone().appendTo($('#pnlFooter'));",500),0==layoutConfig.ft?($pnlFooter.hide(),$handleFooter.hide()):1==layoutConfig.ft?($pnlFooter.show(),$handleFooter.show(),$handleFooter.hasClass("ui-drawer-open")||uiDrawerFooterToggle(!0)):2==layoutConfig.ft&&($pnlFooter.show(),$handleFooter.show());var $handleMainA=$("#handleMainA"),$divTools=$("#divTools");isSmallScreen()?($handleMainA.hide(),$divTools.hide(),1!=layoutConfig.tl&&2!=layoutConfig.tl||$pnlFooter.prepend($("#btnSave").clone())):0==layoutConfig.tl?($handleMainA.hide(),$divTools.hide()):1==layoutConfig.tl?($handleMainA.show(),$divTools.show(),$handleMainA.hasClass("ui-drawer-open")||uiDrawerAToggle(!0)):2==layoutConfig.tl&&($handleMainA.show(),$divTools.show());var $pnlMainC=$("#pnlMainC"),$handleMainC=$("#handleMainC");isSmallScreen()&&$("#layoutComponents, #layoutFurniture").hide(),0==layoutConfig.op?($pnlMainC.hide(),$handleMainC.hide()):1==layoutConfig.op?($pnlMainC.show(),$handleMainC.show(),!bRan_uiSetupLayout&&$handleMainC.hasClass("ui-drawer-open")&&uiDrawerCToggle(!0)):2==layoutConfig.op?($pnlMainC.show(),$handleMainC.show()):3==layoutConfig.op&&($pnlMainC.show(),$handleMainC.show(),bRan_uiSetupLayout||($handleMainC.hasClass("ui-drawer-open")&&uiDrawerCToggle(!0),setTimeout("uiDrawerCToggle(false);",6e3))),uiLayoutOptionsPOISetupPopup(),bRan_uiSetupLayout=!0}}function uiLayoutOptionsPOISetupPopup(){var boundsTmp;dbg("uiLayoutOptionsPOISetupPopup()");var $layoutStage=$("#layoutStage"),$layoutDialogPOI=$("#layoutDialogPOI"),$divDialogPOI=$("#divDialogPOI"),$POIContainer=$layoutDialogPOI.parents(".ui-popup-container");isTouchDevice()?(boundsTmp=$("body").bounds(),$divDialogPOI.css("width",boundsTmp.width-8).css("height",boundsTmp.height-8)):(boundsTmp=$layoutStage.bounds(),$divDialogPOI.css("width",boundsTmp.width-20).css("height",boundsTmp.height-20)),$POIContainer&&$POIContainer.hasClass("ui-popup-active")?($layoutDialogPOI.off("popupafterclose"),$layoutDialogPOI.popup("close"),$layoutDialogPOI.popup("open")):isTouchDevice()?$layoutDialogPOI.popup({positionTo:"window",tolerance:1}):$layoutDialogPOI.popup({positionTo:"#divStage",tolerance:1}),$layoutDialogPOI.on("popupafterclose",(function(){$divDialogPOI.empty()}))}function uiLayoutOptionsSetupScroller(){}function uiOnResized(){(uiSetupLayout(!0),void 0!==$dataViews)&&("svg"===$dataViews.find("view[id="+uiViewsCurrentID+"]").attr("type")&&planZoom("INIT",!0));uiLayoutOptionsPOISetupPopup()}function uiUpdateAfterZoom(percent,finalize){if(finalize){var $slider=$("#btnZoomSlider");$slider.off("change",uiZoomSliderChanged),$slider.val(percent),$slider.slider("refresh"),$slider.on("change",uiZoomSliderChanged)}}function uiZoomAll(){planZoom("ALL",!0)}function uiZoomIn(){planZoom("IN",!0)}function uiZoomOut(){planZoom("OUT",!0)}function uiZoomSliderChanged(){var percent=parseFloat($("#btnZoomSlider").val());planZoom(percent,!1),executeAfterFinal(uiZoomSliderReleased,500,"uiZoomSliderChanged-uiZoomSliderReleased")}function uiZoomSliderReleased(){var percent=parseFloat($("#btnZoomSlider").val());planZoom(percent,!0)}function uiSetupEvents(){if($("#btnFlipH").on("tap",planFlipH),$("#btnFlipV").on("tap",planFlipV),$("#btnLineTool").on("tap",dropLineStart),$("#btnZoomAll").on("tap",uiZoomAll),isTouchDevice())$("#divZoomSlider").hide(),$("#btnZoomIn").show().on("tap",uiZoomIn),$("#btnZoomOut").show().on("tap",uiZoomOut);else{$("#btnZoomIn").hide(),$("#btnZoomOut").hide();var $slider=$("#btnZoomSlider");$slider.show(),$slider.attr("min",ZOOM_MIN),$slider.attr("max",ZOOM_MAX),$slider.attr("step",ZOOM_STEP_SLIDER),$slider.val(ZOOM_DEFAULT),$slider.slider("refresh"),$slider.on("change",uiZoomSliderChanged),$slider.hide(),$("#divZoomSlider").find(".ui-btn").on("mouseup touchcancel touchend",uiZoomSliderReleased)}$("#btnDialogResetGo").on("vmousedown",(function(){bRan_uiSetupLayout=void 0,dataPlanLoad()})),$("#btnDialogSaveGo").on("vmousedown",(function(){dbg('#btnDialogSaveGo(on("vmousedown")'),$("#txtPlanName").blur(),$("#layoutDialogSave").attr("tabindex",-1).focus(),dataPlanSave("txt",!1),vip_gtag("button","plan","save_submit")})),$("#btnDialogSaveCancel").on("vmousedown",(function(){dbg('#btnDialogSaveCancel(on("vmousedown")'),$("#txtPlanName").blur(),$("#layoutDialogSave").attr("tabindex",-1).focus()}));var $saveDialog=$("#layoutDialogSave");$saveDialog.on("popupbeforeposition",(function(){uiIsKeyboardDialogShowing=!0})),$saveDialog.on("popupafterclose",(function(){uiIsKeyboardDialogShowing=!1})),$("#btnSave").on("vmousedown",(function(){vip_gtag("button","plan","save_start")})),$("#btnDialogPrintGo").on("vmousedown",uiDialogPrintGo),$("#btnDialogPrintCancel").on("vmousedown",uiDialogPrintCancel);var $printDialog=$("#layoutDialogPrint");$printDialog.on("popupbeforeposition",uiDialogPrintPreShow),$printDialog.on("popupafteropen",uiDialogPrintShow),$("#btnNoteTool").on("tap",dropNoteStart),$("#btnDialogNoteGo").on("vmousedown",dropNoteBarEditTxtSave),$("#btnDialogNoteCancel").on("vmousedown",dropNoteBarEditTxtCancel);var $dialogNote=$("#layoutDialogNote");$dialogNote.on("popupbeforeposition",(function(){uiIsKeyboardDialogShowing=!0})),$dialogNote.on("popupafteropen",(function(){})),$dialogNote.on("popupafterclose",(function(){$dialogNote.find("textarea").blur(),$dialogNote.attr("tabindex",-1).focus(),uiIsKeyboardDialogShowing=!1,dropNoteBarEditTxtCancel()})),$("#btnDialogHaloSizeGo").on("vmousedown",componentHaloSizeGo),$("#btnDialogHaloSizeCancel").on("vmousedown",componentHaloSizeCancel);var $dialogHaloSize=$("#layoutDialogHaloSize");$dialogHaloSize.popup(),$dialogHaloSize.on("popupbeforeposition",(function(){uiIsKeyboardDialogShowing=!0})),$dialogHaloSize.on("popupafteropen",(function(){})),$dialogHaloSize.on("popupafterclose",(function(){$dialogHaloSize.find("input").blur(),$dialogHaloSize.attr("tabindex",-1).focus(),uiIsKeyboardDialogShowing=!1})),$dialogHaloSize.on("keyup",(function(e){13==e.keyCode&&componentHaloSizeGo()})),$(window).on("resize orientationchange",(function(e){if(uiIsKeyboardDialogShowing)return killEvent(e);executeAfterFinal(uiOnResized,250,"onResize-uiOnResized")}))}function uiDialogPrintPreShow(){$("#divDialogPrint").addClass("ui-loading"),$("#divPrintPreview").empty()}function uiDialogPrintShow(){svgPrint($("#divPrintPreview"),!0,!1,void 0,void 0)}function uiDialogPrintShowAfterTS(){$("#divDialogPrint").removeClass("ui-loading")}function uiDialogPrintCancel(){$("#divPrintPreview").empty()}function uiDialogPrintGo(){$("#layoutDialogPrint").popup("close");var $pagesContainer=$("#layoutPrintFrame").contents().find("html body");$pagesContainer.empty(),svgPrint($pagesContainer,!1,!1,void 0,void 0),vip_gtag("button","plan","print_submit")}function uiDialogPrintGoAfterTS(){var printedOK,iframePrintEl=$("#layoutPrintFrame")[0];iframePrintEl.contentWindow.focus();try{printedOK=iframePrintEl.contentWindow.document.execCommand("print",!1,null)}catch(ex){printedOK=void 0}printedOK||iframePrintEl.contentWindow.print(),$("#divPrintPreview").empty()}function PNGAfterTS(successfunc){dbg("PNGAfterTS(successfunc) "+successfunc),$("#layoutPrintFrame").contents().find("svg").length>0&&(PNGSuccessFunc=successfunc,PNGCurrentPageNumber=0,PNGArray=new Array(1),PNGRenderPage(0))}function PNGRenderPage(pageNumber){var $svgPage=$("#layoutPrintFrame").contents().find("svg")[pageNumber],canvas=document.getElementById("canvas");canvas.width=1700,canvas.height=2200;var context=canvas.getContext("2d");context.fillStyle="white",context.fillRect(0,0,canvas.width,canvas.height),context.fillStyle="black",$svgPage.removeAttribute("style"),canvg("canvas",$svgPage.outerHTML,{ignoreMouse:!0,ignoreAnimation:!0,ignoreClear:!0,ignoreDimensions:!1,renderCallback:function(dom){PNGArray[PNGCurrentPageNumber]=canvas.toDataURL("image/png"),++PNGCurrentPageNumber>=PNGArray.length?PNGSavePages():PNGRenderPage(PNGCurrentPageNumber)}})}function PNGSavePages(){$.ajax({url:"/vip.social.pngsave.php",type:"POST",data:{savedPlanGUID:dataSavedPlanID,pageCount:PNGArray.length,png0Base64:PNGArray[0],png1Base64:PNGArray[1],png2Base64:PNGArray[2],png3Base64:PNGArray[3],png4Base64:PNGArray[4],png5Base64:PNGArray[5],png6Base64:PNGArray[6],png7Base64:PNGArray[7],png8Base64:PNGArray[8],png9Base64:PNGArray[9],successfunc:PNGSuccessFunc},success:PNGSaveSuccess,error:PNGSaveError}),PNGArray=void 0}!function($){$.fn.bounds=function(includeMargin){var t=this,e=t[0];if(e){var pos,offset=t.offset();return(pos=includeMargin?{width:t.outerWidth(!0),height:t.outerHeight(!0),left:0,top:0,right:0,bottom:0,x:0,y:0}:{width:e.offsetWidth,height:e.offsetHeight,left:0,top:0,right:0,bottom:0,x:0,y:0}).left=offset.left,pos.top=offset.top,pos.right=pos.left+pos.width,pos.bottom=pos.top+pos.height,pos.x=pos.left,pos.y=pos.top,pos.inner={width:t.width(),height:t.height()},$.extend(pos,{toString:function(){var t=this;return"x: "+t.x+" y: "+t.y+" width: "+t.width+" height: "+t.height+" right: "+t.right+" bottom: "+t.bottom}}),pos}},$.fn.testMargin=function(neighbor,neighborPosition){var maxmar;return"left"==neighborPosition?maxmar=parseFloat(this.css("margin-left"))>parseFloat(neighbor.css("margin-right"))?this.css("margin-left"):neighbor.css("margin-right"):"right"==neighborPosition?maxmar=parseFloat(this.css("margin-right"))>parseFloat(neighbor.css("margin-left"))?this.css("margin-right"):neighbor.css("margin-left"):"top"==neighborPosition?maxmar=parseFloat(this.css("margin-top"))>parseFloat(neighbor.css("margin-bottom"))?this.css("margin-top"):neighbor.css("margin-bottom"):"bottom"==neighborPosition&&(maxmar=parseFloat(this.css("margin-bottom"))>parseFloat(neighbor.css("margin-top"))?this.css("margin-bottom"):neighbor.css("margin-top")),parseFloat(maxmar)}}(jQuery),$((function(){$(".ui-dropdown-ctl").live("tap",uiDropdownSelect)})),$((function(){$(".ui-tabs-ctl").on("click",uiTabsSelect)})),$((function(){$("#btnHandleA").button(),$("#btnHandleA").on("vmouseup",uiDrawerAToggle),$("#btnHandleC").on("vmouseup",uiDrawerCToggle),$("#btnFooter").button(),$("#btnHandleFooter").on("vmouseup",uiDrawerFooterToggle)}));