/*!
 * jQuery Mobile v1.0b2
 * http://jquerymobile.com/
 *
 * Copyright 2010, jQuery Project
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 */
/*!
 * jQuery UI Widget @VERSION
 *
 * Copyright 2010, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Widget
 */
/*!
 * jQuery Mobile Framework : "slider" plugin
 * Copyright (c) jQuery Project
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * Forked by Elmundio87 to add vertical orientation
 * http://jquery.org/license
 */
!function($,undefined){$.widget("mobile.slider",$.mobile.widget,{options:{theme:null,trackTheme:null,disabled:!1,initSelector:"input[type='range'], :jqmData(type='range'), :jqmData(role='slider')",mini:!1},_create:function(){var options,bg,self=this,control=this.element,parentTheme=$.mobile.getInheritedTheme(control,"c"),theme=this.options.theme||parentTheme,trackTheme=this.options.trackTheme||parentTheme,cType=control[0].nodeName.toLowerCase(),selectClass="select"==cType?"ui-slider-switch":"",controlID=control.attr("id"),labelID=controlID+"-label",label=$("[for='"+controlID+"']").attr("id",labelID),val=function(){return"input"==cType?parseFloat(control.val()):control[0].selectedIndex},min="input"==cType?parseFloat(control.attr("min")):0,max="input"==cType?parseFloat(control.attr("max")):control.find("option").length-1,sliderOrientation=control.attr("sliderOrientation")||"horizontal",step=window.parseFloat(control.attr("step")||1),inlineClass=this.options.inline||1==control.jqmData("inline")?" ui-slider-inline":"",miniClass=this.options.mini||control.jqmData("mini")?" ui-slider-mini":"",domHandle=document.createElement("a"),handle=$(domHandle),domSlider=document.createElement("div"),slider=$(domSlider),valuebg=!(!control.jqmData("highlight")||"select"==cType)&&((bg=document.createElement("div")).className="ui-slider-bg ui-btn-active ui-btn-corner-all",$(bg).prependTo(slider));if(domHandle.setAttribute("href","#"),domSlider.setAttribute("role","application"),domSlider.className=["ui-slider-"+sliderOrientation,selectClass," ui-btn-down-",trackTheme," ui-btn-corner-all",inlineClass,miniClass].join(""),domHandle.className="ui-slider-handle-"+sliderOrientation,domSlider.appendChild(domHandle),handle.buttonMarkup({corners:!0,theme:theme,shadow:!0}).attr({role:"slider","aria-valuemin":min,"aria-valuemax":max,"aria-valuenow":val(),"aria-valuetext":val(),title:val(),"aria-labelledby":labelID}),$.extend(this,{slider:slider,handle:handle,valuebg:valuebg,dragging:!1,beforeStart:null,userModified:!1,mouseMoved:!1}),"select"==cType){var wrapper=document.createElement("div");wrapper.className="ui-slider-inneroffset";for(var j=0,length=domSlider.childNodes.length;j<length;j++)wrapper.appendChild(domSlider.childNodes[j]);domSlider.appendChild(wrapper),handle.addClass("ui-slider-handle-snapping");for(var i=0,optionsCount=(options=control.find("option")).length;i<optionsCount;i++){var side=i?"a":"b",sliderTheme=i?" "+$.mobile.activeBtnClass:" ui-btn-down-"+trackTheme,sliderImg=(document.createElement("div"),document.createElement("span"));sliderImg.className=["ui-slider-label ui-slider-label-",side,sliderTheme," ui-btn-corner-all"].join(""),sliderImg.setAttribute("role","img"),sliderImg.appendChild(document.createTextNode(options[i].innerHTML)),$(sliderImg).prependTo(slider)}self._labels=$(".ui-slider-label",slider)}label.addClass("ui-slider"),control.addClass("input"===cType?"ui-slider-input":"ui-slider-switch").change((function(){self.mouseMoved||self.refresh(val(),!0)})).keyup((function(){self.refresh(val(),!0,!0)})).blur((function(){self.refresh(val(),!0)})),$(document).bind("vmousemove",(function(event){if(self.dragging)return self.mouseMoved=!0,"select"===cType&&handle.removeClass("ui-slider-handle-snapping"),self.refresh(event),self.userModified=self.beforeStart!==control[0].selectedIndex,!1})),slider.bind("vmousedown",(function(event){return self.dragging=!0,self.userModified=!1,self.mouseMoved=!1,"select"===cType&&(self.beforeStart=control[0].selectedIndex),self.refresh(event),!1})).bind("vclick",!1),slider.add(document).bind("vmouseup",(function(){if(self.dragging)return self.dragging=!1,"select"===cType&&(handle.addClass("ui-slider-handle-snapping"),self.mouseMoved?self.userModified?self.refresh(0==self.beforeStart?1:0):self.refresh(self.beforeStart):self.refresh(0==self.beforeStart?1:0)),self.mouseMoved=!1,!1})),slider.insertAfter(control),"select"==cType&&this.handle.bind({focus:function(){slider.addClass($.mobile.focusClass)},blur:function(){slider.removeClass($.mobile.focusClass)}}),this.handle.bind({vmousedown:function(){$(this).focus()},vclick:!1,keydown:function(event){var index=val();if(!self.options.disabled){switch(event.keyCode){case $.mobile.keyCode.HOME:case $.mobile.keyCode.END:case $.mobile.keyCode.PAGE_UP:case $.mobile.keyCode.PAGE_DOWN:case $.mobile.keyCode.UP:case $.mobile.keyCode.RIGHT:case $.mobile.keyCode.DOWN:case $.mobile.keyCode.LEFT:event.preventDefault(),self._keySliding||(self._keySliding=!0,$(this).addClass("ui-state-active"))}switch(event.keyCode){case $.mobile.keyCode.HOME:self.refresh(min);break;case $.mobile.keyCode.END:self.refresh(max);break;case $.mobile.keyCode.PAGE_UP:case $.mobile.keyCode.UP:case $.mobile.keyCode.RIGHT:self.refresh(index+step);break;case $.mobile.keyCode.PAGE_DOWN:case $.mobile.keyCode.DOWN:case $.mobile.keyCode.LEFT:self.refresh(index-step)}}},keyup:function(event){self._keySliding&&(self._keySliding=!1,$(this).removeClass("ui-state-active"))}}),this.refresh(undefined,undefined,!0)},refresh:function(val,isfromControl,preventInputUpdate){(this.options.disabled||this.element.attr("disabled"))&&this.disable();var percent,control=this.element,cType=control[0].nodeName.toLowerCase(),min="input"===cType?parseFloat(control.attr("min")):0,max="input"===cType?parseFloat(control.attr("max")):control.find("option").length-1,step="input"===cType&&parseFloat(control.attr("step"))>0?parseFloat(control.attr("step")):1;if(sliderOrientation=control.attr("sliderOrientation")||"horizontal","object"==typeof val){var data=val;if(!this.dragging||data.pageX<this.slider.offset().left-8||data.pageX>this.slider.offset().left+this.slider.width()+8)return;"horizontal"==sliderOrientation?percent=Math.round((data.pageX-this.slider.offset().left)/this.slider.width()*100):"vertical"==sliderOrientation?percent=Math.round((data.pageY-this.slider.offset().top)/this.slider.height()*100):"verticalInverted"==sliderOrientation&&(percent=100-Math.round((data.pageY-this.slider.offset().top)/this.slider.height()*100))}else null==val&&(val="input"===cType?parseFloat(control.val()||0):control[0].selectedIndex),percent=(parseFloat(val)-min)/(max-min)*100;if(!isNaN(percent)){percent<0&&(percent=0),percent>100&&(percent=100);var newval=percent/100*(max-min)+min,valModStep=(newval-min)%step,alignValue=newval-valModStep;if(2*Math.abs(valModStep)>=step&&(alignValue+=valModStep>0?step:-step),(newval=parseFloat(alignValue.toFixed(5)))<min&&(newval=min),newval>max&&(newval=max),"horizontal"==sliderOrientation?this.handle.css("left",percent+"%"):"vertical"==sliderOrientation?this.handle.css("top",percent+"%"):"verticalInverted"==sliderOrientation&&this.handle.css("top",100-percent+"%"),this.handle.attr({"aria-valuenow":"input"===cType?newval:control.find("option").eq(newval).attr("value"),"aria-valuetext":"input"===cType?newval:control.find("option").eq(newval).getEncodedText(),title:"input"===cType?newval:control.find("option").eq(newval).getEncodedText()}),this.valuebg&&this.valuebg.css("width",percent+"%"),this._labels){var handlePercent=this.handle.width()/this.slider.width()*100,aPercent=percent&&handlePercent+(100-handlePercent)*percent/100,bPercent=100===percent?0:Math.min(handlePercent+100-aPercent,100);this._labels.each((function(){var ab=$(this).is(".ui-slider-label-a");$(this).width((ab?aPercent:bPercent)+"%")}))}if(!preventInputUpdate){var valueChanged=!1;"input"===cType?(valueChanged=control.val()!==newval,control.val(newval)):(valueChanged=control[0].selectedIndex!==newval,control[0].selectedIndex=newval),!isfromControl&&valueChanged&&control.trigger("change")}}},enable:function(){return this.element.attr("disabled",!1),this.slider.removeClass("ui-disabled").attr("aria-disabled",!1),this._setOption("disabled",!1)},disable:function(){return this.element.attr("disabled",!0),this.slider.addClass("ui-disabled").attr("aria-disabled",!0),this._setOption("disabled",!0)}}),$(document).bind("pagecreate create",(function(e){$.mobile.slider.prototype.enhanceWithin(e.target,!0)}))}(jQuery);