var SVG_PRINT_VIEWPORT_PADDING=50,svgPrintEntireWidth=612,svgPrintEntireHeight=792;function svgPrint($pagesContainer,isPreview,isPNG,successfunc,saved_plan_guid){var urlSVG=$dataInfo.attr("printsvgfile");$.ajax({url:urlSVG,dataType:"xml",success:function(data){svgPrintParseTemplate(data,$pagesContainer,isPreview,isPNG,successfunc,saved_plan_guid,void 0)}})}function svgPrintParseTemplate(data,$pagesContainer,isPreview,isPNG,successfunc,saved_plan_guid,scaleMax){var scaleTmp,scaleFirst,$svgTemplate=$(data).find("svg"),arrTemplateViewbox=$svgTemplate.attr("viewBox").split(" ");arrTemplateViewbox[2]&&(arrTemplateViewbox[2]=parseFloat(arrTemplateViewbox[2]),arrTemplateViewbox[2]>0&&(svgPrintEntireWidth=arrTemplateViewbox[2])),arrTemplateViewbox[3]&&(arrTemplateViewbox[3]=parseFloat(arrTemplateViewbox[3]),arrTemplateViewbox[3]>0&&(svgPrintEntireHeight=arrTemplateViewbox[3])),$svgTemplate.removeAttr("width"),$svgTemplate.removeAttr("height");for(var pageNum=1;pageNum<=10;pageNum++)void 0!==(scaleTmp=svgPrintParseTemplatePage($svgTemplate,$pagesContainer,pageNum,scaleMax))&&(scaleMax=scaleTmp,void 0===scaleFirst&&(scaleFirst=scaleTmp));if(scaleMax!=scaleFirst){$pagesContainer.empty();var urlSVG=$dataInfo.attr("printsvgfile");$.ajax({url:urlSVG,dataType:"xml",success:function(data){svgPrintParseTemplate(data,$pagesContainer,isPreview,isPNG,successfunc,saved_plan_guid,scaleMax)}})}else apiPrintCompleted(isPreview,isPNG,successfunc,saved_plan_guid)}function svgPrintParseTemplatePage($svgTemplate,$pagesContainer,pageNum,scaleMax){var $svgPage,$divPage,$gPageLayer,placeholderEl,placeholderNum,scaleTmp,pageExists=!1,pageHasText=!1,pageHasContent=!1,$divPageTemplate=$('<div class="pagewrapper"/>'),$gPageLayerCommon=$svgTemplate.find("#p\\.all").clone(!1,!1);return($svgPage=$svgTemplate.clone(!1,!1).empty()).attr("shape-rendering","geometricPrecision"),$svgPage.attr("text-rendering","geometricPrecision"),$svgPage.attr("style","width:100%; height:100%;"),($divPage=$divPageTemplate.clone(!1,!1)).append($svgPage),$pagesContainer.append($divPage),$svgTemplate.find("[id^=p\\."+pageNum+"]").each((function(){pageExists=!0,$gPageLayer=$(this).clone(!1,!1),$svgPage.append($gPageLayer),-1!==(placeholderEl=$gPageLayer.attr("id")).indexOf("v.")?(placeholderNum=placeholderEl.split("v."),(placeholderNum=parseInt(placeholderNum[1],10))>0&&void 0!==(scaleTmp=svgPrintParseTemplatePlaceholder($gPageLayer,"v",placeholderNum,scaleMax))&&(pageHasContent=!0,0!==scaleTmp&&(scaleMax=scaleTmp))):-1!==placeholderEl.indexOf("x.")&&(placeholderNum=placeholderEl.split("x."),(placeholderNum=parseInt(placeholderNum[1],10))>0&&svgPrintParseTemplatePlaceholder($gPageLayer,"x",placeholderNum,scaleMax)&&(pageHasContent=!0))})),pageExists&&($gPageLayerCommon=$gPageLayerCommon.clone(!1,!1),$svgPage.prepend($gPageLayerCommon),pageHasText=svgPrintParseTemplateText($svgPage,pageNum)),pageHasContent||pageHasText||$divPage.remove(),scaleMax}function svgPrintSetupLegendForViewport($legend,$divPage,$legendMarker,$gViewport){var fStatus=$.deparam.querystring().fstatus;if(!(!Site.Data.Main.$dataLegends||Site.Data.Main.$dataLegends.length<=0||fStatus>0)){var boundsDivPage=$divPage.bounds(!0),boundsLegendMarker=$legendMarker.bounds(!0),legendX=boundsLegendMarker.x-boundsDivPage.x,legendY=boundsLegendMarker.y-boundsDivPage.y;$divPage.append($legend);var boundsLegend=$legend.bounds(!0),legendAlign="",boundsViewport=$gViewport.get(0).getBoundingClientRect(),halfX=boundsViewport.x-boundsDivPage.x+boundsViewport.width/2;legendAlign="BR",legendAlign+=legendY<=boundsViewport.y-boundsDivPage.y+boundsViewport.height/2?"T":"B",-1!==(legendAlign+=legendX<=halfX?"L":"R").indexOf("R")&&(legendX-=boundsLegend.width),-1!==legendAlign.indexOf("B")&&(legendY-=boundsLegend.height),$legend.css("left",legendX+"px"),$legend.css("top",legendY+"px"),$legendMarker.remove()}}function svgPrintParseTemplatePlaceholder($gPageViewportLayer,placeholderType,placeholderNum,scaleMax){var viewScale,viewportX,viewportY,mx,isFlippedH="true"===$dataInfo.attr("flippedh"),isFlippedV="true"===$dataInfo.attr("flippedv"),$viewportMarker=$gPageViewportLayer.children(0);if("x"===placeholderType){var hasContent=!1;if(pathImg=$dataOptions.find("group[typecode='ext'] option:nth-child("+placeholderNum+")").attr("data2")){hasContent=!0,viewportX=parseFloat($viewportMarker.attr("x")),viewportY=parseFloat($viewportMarker.attr("y"));var viewportWidth=parseFloat($viewportMarker.attr("width")),viewportHeight=parseFloat($viewportMarker.attr("height"));($img=$("#divSVGToolbox").find("image").clone(!1,!1).empty()).empty(),$img.attr("xlink:href",pathImg),$img.attr("x",viewportX),$img.attr("y",viewportY),$img.attr("width",viewportWidth),$img.attr("height",viewportHeight),"true"===$dataInfo.attr("flippedh")&&(mx=xfrmSVGGet($img),mx=xfrmMatrixMirror(mx,!0,!1,viewportWidth+2*viewportX,void 0),xfrmSVGSet($img,mx)),$gPageViewportLayer.empty(),$gPageViewportLayer.append($img)}else $gPageViewportLayer.empty();return hasContent}var $viewXMLNode=$dataViews.find("view:nth-child("+placeholderNum+")");if($viewXMLNode.length>0){var viewID=$viewXMLNode.attr("id"),viewDBID=strStripNonNumeric(viewID),viewType=$viewXMLNode.attr("type");if("vis"===viewType){viewScale=0,viewportX=parseFloat($viewportMarker.attr("x")),viewportY=parseFloat($viewportMarker.attr("y"));viewportWidth=parseFloat($viewportMarker.attr("width")),viewportHeight=parseFloat($viewportMarker.attr("height"));var $visOpt,$visOptParent,visTypeCode,visOptImgPath,$vizOptsGroup=$dataOptions.find('group[viewid^="'+viewDBID+'"]'),pathImgBase=$vizOptsGroup.attr("filespath");if(pathImg=$vizOptsGroup.attr("fullsizeimagepath"))($img=$("#divSVGToolbox").find("image").clone(!1,!1).empty()).empty(),$img.attr("xlink:href",pathImg),$img.attr("x",viewportX),$img.attr("y",viewportY),$img.attr("width",viewportWidth),$img.attr("height",viewportHeight),"true"===$dataInfo.attr("flippedh")&&(mx=xfrmSVGGet($img),mx=xfrmMatrixMirror(mx,!0,!1,viewportWidth+2*viewportX,void 0),xfrmSVGSet($img,mx)),$gPageViewportLayer.empty(),$gPageViewportLayer.append($img);$vizOptsGroup.find("option[selected=1]").each((function(){if($visOpt=$(this),"visfinish"==(visTypeCode=$visOpt.attr("typecode"))){if($visOptParent=$vizOptsGroup.find('option[id="o-'+$visOpt.attr("parentoptionid")+'"]'),visOptImgPath=pathImgBase+"/"+$visOptParent.attr("data1")+"/"+$visOpt.attr("data1")){var $img=$("#divSVGToolbox").find("image").clone(!1,!1).empty();$img.empty(),$img.attr("xlink:href",visOptImgPath),$img.attr("x",viewportX),$img.attr("y",viewportY),$img.attr("width",viewportWidth),$img.attr("height",viewportHeight),"true"===$dataInfo.attr("flippedh")&&(mx=xfrmSVGGet($img),mx=xfrmMatrixMirror(mx,!0,!1,viewportWidth+2*viewportX,void 0),xfrmSVGSet($img,mx)),$gPageViewportLayer.append($img)}}else"visscheme"==visTypeCode&&$visOpt.attr("data1").split(",").forEach((function(optId){if((optId=parseFloat(optId))>0&&($visSchemeOpt=$vizOptsGroup.find('option[id="o-'+optId+'"]'),$visOptParent=$vizOptsGroup.find('option[id="o-'+$visSchemeOpt.attr("parentoptionid")+'"]'),visOptImgPath=pathImgBase+"/"+$visOptParent.attr("data1")+"/"+$visSchemeOpt.attr("data1"))){var $img=$("#divSVGToolbox").find("image").clone(!1,!1).empty();$img.empty(),$img.attr("xlink:href",visOptImgPath),$img.attr("x",viewportX),$img.attr("y",viewportY),$img.attr("width",viewportWidth),$img.attr("height",viewportHeight),"true"===$dataInfo.attr("flippedh")&&(mx=xfrmSVGGet($img),mx=xfrmMatrixMirror(mx,!0,!1,viewportWidth+2*viewportX,void 0),xfrmSVGSet($img,mx)),$gPageViewportLayer.append($img)}}))}))}else if("imgs"===viewType||"ext"===viewType){viewScale=0,viewportX=parseFloat($viewportMarker.attr("x")),viewportY=parseFloat($viewportMarker.attr("y"));var pathImg,$img;viewportWidth=parseFloat($viewportMarker.attr("width")),viewportHeight=parseFloat($viewportMarker.attr("height"));if(pathImg=$dataOptions.find('group[viewid^="'+viewDBID+'"]').find("option[selected=1]").attr("data2"))($img=$("#divSVGToolbox").find("image").clone(!1,!1).empty()).empty(),$img.attr("xlink:href",pathImg),$img.attr("x",viewportX),$img.attr("y",viewportY),$img.attr("width",viewportWidth),$img.attr("height",viewportHeight),"true"===$dataInfo.attr("flippedh")&&(mx=xfrmSVGGet($img),mx=xfrmMatrixMirror(mx,!0,!1,viewportWidth+2*viewportX,void 0),xfrmSVGSet($img,mx)),$gPageViewportLayer.empty(),$gPageViewportLayer.append($img)}else if("svg"===viewType){var featureSVGID,viewSVGID=$viewXMLNode.attr("svgid"),$gView=$("#divSVGToolbox").find("g").clone(!1,!1).empty();$svgPlanData.find("g[id="+strEscapeDots(viewSVGID)+"]").clone(!1,!1).appendTo($gView),$viewXMLNode.find("feature[selected=1]").each((function(){featureSVGID=$(this).attr("svgid"),$svgPlanData.find("g[id="+strEscapeDots(viewSVGID+"."+featureSVGID)+"]").clone(!1,!1).appendTo($gView)}));var optionID,putOptionsUnderView=!1;window.Site&&(putOptionsUnderView=!0),svgPlanOptionCreateLayerPlaceholders(viewID,$gView,putOptionsUnderView,!1),$dataOptions.find("group[viewid="+viewDBID+'][typecode!="poi"]').find("option[selected=1]").each((function(){optionID=$(this).attr("id"),svgPlanOptionShowHide(optionID,!0,viewID,$gView,!1,!1),$gView.find('g[id^="poi."]').remove()}));var $gComponents=$("#gComponents").find('g[id^="comps_'+viewID+'"]').clone(!1,!1);if($gComponents.css("display",""),$gComponents.appendTo($gView),$gView.length>0){var $viewportBBox=$viewportMarker.get(0).getBBox();$gPageViewportLayer.empty(),$gPageViewportLayer.append($gView);var $txtNode,$tspanNode1,offsetH,offsetV,offsetLine1,offsetCurrentLine,mxComp,isCompReversed,reverseHCurrentNode,reverseVCurrentNode,$viewBBox=$gView.get(0).getBBox(),viewBBoxWidth=$viewBBox.width+SVG_PRINT_VIEWPORT_PADDING,viewBBoxHeight=$viewBBox.height+SVG_PRINT_VIEWPORT_PADDING,viewBBoxX=$viewBBox.x-SVG_PRINT_VIEWPORT_PADDING/2,viewBBoxY=$viewBBox.y-SVG_PRINT_VIEWPORT_PADDING/2;viewScale=$viewportBBox.width/$viewportBBox.height<viewBBoxWidth/viewBBoxHeight?$viewportBBox.width/viewBBoxWidth:$viewportBBox.height/viewBBoxHeight,void 0!==scaleMax&&viewScale>scaleMax&&(viewScale=scaleMax),mx=xfrmSVGGet($gView),viewportX=$viewportBBox.width/2-viewBBoxWidth/2*viewScale,viewportX+=isFlippedH?$viewportBBox.x+viewBBoxX*viewScale:$viewportBBox.x-viewBBoxX*viewScale,viewportY=$viewportBBox.height/2-viewBBoxHeight/2*viewScale,viewportY+=isFlippedV?$viewportBBox.y+viewBBoxY*viewScale:$viewportBBox.y-viewBBoxY*viewScale,mx=xfrmMatrixMove(mx,viewportX,viewportY),isFlippedH&&(mx=xfrmMatrixMirror(mx,!0,void 0,viewBBoxWidth*viewScale,0)),isFlippedV&&(mx=xfrmMatrixMirror(mx,void 0,!0,0,viewBBoxHeight*viewScale)),mx=xfrmMatrixScale(mx,viewScale,viewScale),xfrmSVGSet($gView,mx),svgPlanFlipOrientTextHelper($gView,isFlippedH,isFlippedV);var fudgeVMultiLine=1.2,fudgeVSingleLine=1.6;isTouchDevice()&&(fudgeVMultiLine=2.4,fudgeVSingleLine=0);var reverseH=isFlippedH,reverseV=isFlippedV;$gView.find("g[id^=comps_]").find("text").each((function(){try{$txtNode=$(this),mxComp=xfrmSVGGet($txtNode.parents("g[id^=comp_]")),void 0!==reverseH&&(offsetH=this.getBBox().width,offsetLine1=0,$txtNode.find("tspan").each((function(){(offsetCurrentLine=parseFloat($(this).attr("x")))<offsetLine1&&(offsetLine1=offsetCurrentLine)})),offsetH+=2*offsetLine1,isCompReversed=xfrmMatrixIsMirroredX(mxComp),reverseHCurrentNode=reverseH&&!isCompReversed||!reverseH&&isCompReversed),void 0!==reverseV&&(offsetV=this.getBBox().height,($tspanNode1=$txtNode.find("tspan:first")).length?(offsetLine1=parseFloat($tspanNode1.attr("font-size")),offsetV=(offsetV-(offsetLine1+fudgeVMultiLine))/2*3-offsetV/2):offsetV=(offsetV+fudgeVSingleLine)/2*-1,isCompReversed=xfrmMatrixIsMirroredY(mxComp),reverseVCurrentNode=reverseV&&!isCompReversed||!reverseV&&isCompReversed),mx=xfrmSVGGet($txtNode),mx=xfrmMatrixMirrorAbsolute(mx,reverseHCurrentNode,reverseVCurrentNode,offsetH,offsetV),xfrmSVGSet($txtNode,mx)}catch(ex){dbg("ERROR! "+ex.message)}})),$svgPlanData.find("g[id="+strEscapeDots(viewSVGID+".background")+"]").clone(!1,!1).prependTo($gView),$svgPlanData.find("g[id="+strEscapeDots("area.legend")+"]").clone(!1,!1).appendTo($gView);var $legendMarker=$gPageViewportLayer.find("g[id="+strEscapeDots("area.legend")+"]");if($legendMarker&&$legendMarker.length>0){var $divPreviewPage=$gPageViewportLayer.parents("div:first");svgPrintSetupLegendForViewport($("#divLegend").clone(!1,!1),$divPreviewPage,$legendMarker,$gPageViewportLayer)}}}}return viewScale}function svgPrintParseTemplateText($svgPage,pageNum){var $txtNode,txt,rxVarMatches,varMatch,rxHintMatches,boundsElText,hintLineHeight,txtY,txtXRightEdge,$spanTmp,$lineTmp,txtOptSelected,optSelectedTypeCode,$optSelectedGroup,txtPricingOption,txtPricingTotal,txtSqFtOption,txtSqFtTotal,totalSqFtText,txtReplace,viewNum,extNum,rxOptionsOld=/\{options\}.*\{options\}/im,rxVar=/\{[\w\.]+(?:\[\w+\]){0,}\}/gim,rxHint=/\[\w+\]/gi,boundsElPage=svgGetBounds($svgPage),$svgToolbox=$("#divSVGToolbox"),$spanTemplate=$svgToolbox.find("tspan").clone(!1,!1).empty(),$lineTemplate=$svgToolbox.find("line").clone(!1,!1).empty(),txtPricingBase=void 0,clientAllowOptionPricingWithoutBasePrice=$dataInfo.attr("clientallowoptionpricingwithoutbaseprice"),txtSqFtBase=void 0;optionPricingIsEnabled()&&(txtPricingBase=$dataInfo.attr("baseprice")),optionSquareFootageIsEnabled()&&(txtSqFtBase=$dataInfo.attr("basesquarefootage"));var pageIncludeInPrinting=!1;return $svgPage.find("text").each((function(){if($txtNode=$(this),txt=$txtNode.text(),!0===rxOptionsOld.test(txt)&&(dbg("WARNING! svgPrintParseTemplateText(): FOUND OLD WAY OF DOING {OPTIONS} VAR!"),(hintLineHeight=parseFloat($txtNode.find("tspan:nth-child(2)").attr("y")))||(hintLineHeight=20),$txtNode.text("{options[lh"+hintLineHeight+"]}"),txt=$txtNode.text()),rxVarMatches=txt.match(rxVar))for(var i=0;i<rxVarMatches.length;i++)if(varMatch=rxVarMatches[i],rxHintMatches=varMatch.match(rxHint),-1!==varMatch.indexOf("options")){if(boundsElText=svgGetBounds($txtNode),$txtNode.empty(),hintLineHeight=(hintLineHeight=rxHintMatches.join("").split("[lh"))[1].split("]"),(hintLineHeight=parseFloat(hintLineHeight[0]))||(hintLineHeight=20),txtY=0,txtXRightEdge=boundsElPage.width<svgPrintEntireWidth?boundsElPage.width:svgPrintEntireWidth-2*boundsElText.x,"1"==clientAllowOptionPricingWithoutBasePrice||void 0!==txtPricingBase||void 0!==txtSqFtBase){if(($spanTmp=$spanTemplate.clone(!1,!1)).attr("y",txtY),$spanTmp.attr("x",0),$spanTmp.text("Standard Plan"),void 0!==txtSqFtBase){var prefix="";void 0!==txtPricingBase&&(prefix=" • "),SqFtText=prefix+parseFloat(txtSqFtBase).toFixed(0).replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")+$dataInfo.attr("clientareatext"),"1"==clientAllowOptionPricingWithoutBasePrice||void 0!==txtPricingBase?($spanTmp2=$spanTemplate.clone(!1,!1),$spanTmp2.attr("style","fill:#777"),$spanTmp2.text(SqFtText),$spanTmp2.appendTo($spanTmp),$spanTmp.appendTo($txtNode)):($spanTmp.appendTo($txtNode),($spanTmp=$spanTmp.clone(!1,!1)).text(SqFtText),$spanTmp.attr("text-anchor","end"),$spanTmp.attr("x",txtXRightEdge),$spanTmp.appendTo($txtNode)),txtSqFtTotal=parseFloat(txtSqFtBase)}else $spanTmp.appendTo($txtNode),SqFtText="",txtSqFtTotal="";1!=clientAllowOptionPricingWithoutBasePrice&&void 0===txtPricingBase||(BasePriceText="",void 0!==txtPricingBase&&"0.00"!==txtPricingBase&&(BasePriceText=strFormatCurrency(txtPricingBase,0)),($spanTmp=$spanTmp.clone(!1,!1)).text(BasePriceText),$spanTmp.attr("text-anchor","end"),$spanTmp.attr("x",txtXRightEdge),$spanTmp.appendTo($txtNode)),txtY+=hintLineHeight}$dataOptions.find('group[typecode!="poi"]').find("option[selected=1]").each((function(){$spanTmp=$spanTemplate.clone(!1,!1),txtPricingOption=$(this).attr("pricingdelta"),(void 0===(txtSqFtOption=parseFloat($(this).attr("squarefootagedelta")))||isNaN(txtSqFtOption)||0==txtSqFtOption)&&(txtSqFtOption=""),txtOptSelected="",optSelectedTypeCode=$(this).attr("typecode"),$optSelectedGroup=$(this).parent("group"),"visfinish"==optSelectedTypeCode?txtOptSelected+=$optSelectedGroup.find('option[id="o-'+$(this).attr("parentoptionid")+'"]').attr("displayname")+": ":"visscheme"==optSelectedTypeCode&&(txtOptSelected+=$optSelectedGroup.attr("displayname")+": "),txtOptSelected+=$(this).attr("displayname"),$spanTmp.text(txtOptSelected),$spanTmp.attr("y",txtY),$spanTmp.attr("x",0);var prefix="";if(1!=clientAllowOptionPricingWithoutBasePrice&&void 0===txtPricingBase||(prefix=" • "),""!=txtSqFtTotal&&""!=txtSqFtOption){var OptionSqFtText=prefix+parseFloat(txtSqFtOption).toFixed(0).replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")+$dataInfo.attr("clientareatext");1!=clientAllowOptionPricingWithoutBasePrice&&void 0===txtPricingBase||void 0===txtPricingOption?($spanTmp.appendTo($txtNode),($spanTmp=$spanTmp.clone(!1,!1)).text(OptionSqFtText),$spanTmp.attr("text-anchor","end"),$spanTmp.attr("x",txtXRightEdge),$spanTmp.appendTo($txtNode)):($spanTmp2=$spanTemplate.clone(!1,!1),$spanTmp2.attr("style","fill:#777"),$spanTmp2.text(OptionSqFtText),$spanTmp2.appendTo($spanTmp),$spanTmp.appendTo($txtNode)),txtSqFtTotal+=parseFloat(txtSqFtOption)}else $spanTmp.appendTo($txtNode);if((1==clientAllowOptionPricingWithoutBasePrice||void 0!==txtPricingBase)&&void 0!==txtPricingOption){$spanTmp=$spanTmp.clone(!1,!1);var OptionPriceText="";void 0!==txtPricingOption&&(OptionPriceText=strFormatCurrency(txtPricingOption,0)),$spanTmp.text(OptionPriceText),$spanTmp.attr("text-anchor","end"),$spanTmp.attr("x",txtXRightEdge),$spanTmp.appendTo($txtNode)}txtY+=hintLineHeight,pageIncludeInPrinting=!0})),void 0===(txtPricingTotal=void 0!==txtPricingBase?$("#tblLegendPricing").find("tr.total").find("td:nth-child(1)").text():"")&&void 0===txtSqFtTotal||(void 0!==txtSqFtBase&&""!==txtSqFtTotal?(totalSqFtText=parseFloat(txtSqFtTotal).toFixed(0).replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")+$dataInfo.attr("clientareatext"),"1"==clientAllowOptionPricingWithoutBasePrice||void 0!==txtPricingBase?(($spanTmp=$spanTemplate.clone(!1,!1)).attr("y",txtY),$spanTmp.attr("x",0),$spanTmp.text("Total with selected options: "),$spanTmp2=$spanTemplate.clone(!1,!1),$spanTmp2.attr("style","fill:#777"),$spanTmp2.text(totalSqFtText),$spanTmp2.appendTo($spanTmp),$spanTmp.appendTo($txtNode)):(($spanTmp=$spanTemplate.clone(!1,!1)).text(totalSqFtText),$spanTmp.attr("text-anchor","end"),$spanTmp.attr("y",txtY),$spanTmp.attr("x",txtXRightEdge),$spanTmp.css("font-weight","bold"),$spanTmp.appendTo($txtNode))):totalSqFtText="",void 0!==txtPricingTotal&&(($spanTmp=$spanTemplate.clone(!1,!1)).text(txtPricingTotal),$spanTmp.attr("text-anchor","end"),$spanTmp.attr("y",txtY),$spanTmp.attr("x",txtXRightEdge),$spanTmp.css("font-weight","bold"),$spanTmp.appendTo($txtNode)),txtY=boundsElText.y+txtY-.7*hintLineHeight,($lineTmp=$lineTemplate.clone(!1,!1)).attr("stroke",UI_COLOR_PRINTING_DEFAULT).attr("stroke-width","0.6"),$lineTmp.attr("x1",boundsElText.x).attr("x2",boundsElText.x+txtXRightEdge),$lineTmp.attr("y1",txtY).attr("y2",txtY),$lineTmp.appendTo($txtNode.parents("g"))),0==$txtNode.children().length&&$txtNode.text("No options selected"),rxHintMatches&&svgPrintFormatTextNode($txtNode,boundsElText,rxHintMatches)}else $txtNode.children("tspan[y!=0]").length>0&&txt!==varMatch?(txt="WARNING! Multi-line text blocks with variables not yet supported!",$txtNode.text(txt)):(-1!==varMatch.toLowerCase().indexOf("useremail")&&(txtReplace=void 0!==$dataInfo.attr("savedplanemail")?$dataInfo.attr("savedplanemail"):"",txt=txt.replace(varMatch,txtReplace)),-1!==varMatch.toLowerCase().indexOf("userphone")&&(txtReplace=void 0!==$dataInfo.attr("savedplanphone")?$dataInfo.attr("savedplanphone"):"",txt=txt.replace(varMatch,txtReplace)),-1!==varMatch.toLowerCase().indexOf("userfirstname")&&(txtReplace=void 0!==$dataInfo.attr("savedplanfirstname")?$dataInfo.attr("savedplanfirstname"):"",txt=txt.replace(varMatch,txtReplace)),-1!==varMatch.toLowerCase().indexOf("userlastname")&&(txtReplace=void 0!==$dataInfo.attr("savedplanlastname")?$dataInfo.attr("savedplanlastname"):"",txt=txt.replace(varMatch,txtReplace)),-1!==varMatch.toLowerCase().indexOf("savedplanname")&&(txtReplace=void 0!==$dataInfo.attr("savedplanname")?$dataInfo.attr("savedplanname"):"",txt=txt.replace(varMatch,txtReplace)),-1!==varMatch.toLowerCase().indexOf("date")&&(txt=txt.replace(varMatch,(new Date).toLocaleDateString())),-1!==varMatch.toLowerCase().indexOf("client")&&(txtReplace=void 0!==$dataInfo.attr("client")?$dataInfo.attr("client"):"",txt=txt.replace(varMatch,txtReplace)),-1!==varMatch.toLowerCase().indexOf("project")&&(txtReplace=void 0!==$dataInfo.attr("projectname")?$dataInfo.attr("projectname"):"",txt=txt.replace(varMatch,txtReplace)),-1!==varMatch.toLowerCase().indexOf("plan")&&(txtReplace=void 0!==$dataInfo.attr("displayname")?$dataInfo.attr("displayname"):"",txt=txt.replace(varMatch,txtReplace)),-1!==varMatch.indexOf("v.")&&(viewNum=txt.split("."),viewNum=parseInt(viewNum[1]),txtReplace=void 0!==(txtReplace=$dataViews.find("view:nth-child("+viewNum+")").attr("displayname"))?txtReplace:"",txt=txt.replace(varMatch,txtReplace)),-1!==varMatch.indexOf("x.")&&(extNum=txt.split("."),extNum=parseInt(extNum[1]),txtReplace=void 0!==(txtReplace=$dataOptions.find("group[typecode='ext'] option:nth-child("+extNum+")").attr("displayname"))?txtReplace:"",txt=txt.replace(varMatch,txtReplace)),boundsElText=svgGetBounds($txtNode),$txtNode.text(txt),rxHintMatches&&svgPrintFormatTextNode($txtNode,boundsElText,rxHintMatches))})),pageIncludeInPrinting}function svgPrintFormatTextNode($txtNode,boundsOriginal,arrayFormatHints){for(var newX,newY,mx,h=0;h<arrayFormatHints.length;h++)newY=boundsOriginal.y,"[jr]"===arrayFormatHints[h]?($txtNode.attr("text-anchor","end"),newX=boundsOriginal.x+boundsOriginal.width):"[jc]"===arrayFormatHints[h]?($txtNode.attr("text-anchor","middle"),newX=boundsOriginal.x+boundsOriginal.width/2):$txtNode.attr("text-anchor","start"),$txtNode.removeAttr("x"),$txtNode.removeAttr("y"),mx=xfrmSVGGet($txtNode),mx=xfrmMatrixMoveAbsolute(mx,newX,newY),xfrmSVGSet($txtNode,mx)}